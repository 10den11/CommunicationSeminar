Django migration

insert into ComSemApp_institution values (1, "Gonzaga University", "Spokane", "WA", "United States");

insert into ComSemApp_country select * from SmallTalkOld.Country;

insert into ComSemApp_language select LanguageID, Language from SmallTalkOld.Languages;

insert into ComSemApp_tag select NULL, Tag, TagType, Frequency, NULL from SmallTalkOld.CLAWS7;

insert ignore into ComSemApp_topic select TopicID, Topic from SmallTalkOld.Topics;

insert into ComSemApp_sessiontype select SessionTypeID, SessionName, OrderNumber, InstitutionID from SmallTalkOld.SessionType;

insert into ComSemApp_session (select SessionInstanceID, IFNULL(StartDate, now()), IFNULL(EndDate, now()), SessionTypeID from SmallTalkOld.SessionInstance);

insert into ComSemApp_coursetype select replace(CourseTypesID, 0, 10), CommonName, 1, CourseTypeName from SmallTalkOld.CourseTypes;

# !
delete  from SmallTalkOld.Courses where sessioninstanceid = 0;

insert into ComSemApp_course select CourseID, IFNULL(replace(CourseTypesID, 0, 10), 8), SessionInstanceID, Section from SmallTalkOld.Courses;

# replace no course type id with 8 -> Com Sem



STUDENTS
# preparation of old table
delete from SmallTalkOld.Students where firstname = 'myfirstname'; # might be necessary - need to delete duplicates
 Update SmallTalkOld.Students set Citizenship = NULL where Citizenship = 0;

 insert into auth_user select StudentID, 'password', NULL, 0,  replace(concat(IFNULL(firstname, ''), IFNULL(lastname, '')), ' ', ''), IFNULL(FirstName, ''), IFNULL(LastName,''), IFNULL(email, ''), 0, 0, NOW() FROM SmallTalkOld.Students on duplicate key update username = concat(username, '1');

insert ignore into  ComSemApp_student (select StudentID, Citizenship, 1, Replace(Language, 0, NULL), StudentID from SmallTalkOld.Students where StudentID in (select id from auth_user));


TEACHERS
delete from SmallTalkOld.Teachers where firstname = 'myfirstname';

insert into auth_user select NULL, 'password', NULL, 0,  replace(concat(IFNULL(firstname, ''), IFNULL(lastname, '')), ' ', ''), IFNULL(FirstName, ''), IFNULL(LastName,''), IFNULL(email, ''), 0, 0, NOW() FROM SmallTalkOld.Teachers on duplicate key update username = concat(username, '1');

insert into ComSemApp_teacher (select t.TeacherID, u.id from auth_user as u, SmallTalkOld.Teachers as t where u.username = replace(concat(IFNULL(t.firstname, ''), IFNULL(t.lastname, '')), ' ', '') );

insert into ComSemApp_teacher_institution select NULL, id, 1 from ComSemApp_teacher;

insert into ComSemApp_course_teachers select NULL, c.CourseID, ti.TeacherID from SmallTalkOld.Courses as c, SmallTalkOld.TeachingInstance as ti where c.TeachingInstanceID = ti.TeachingInstanceID;


WORKSHEETS
insert into ComSemApp_worksheet select WorksheetID, Date, replace(replace(EditStatus, 'Released', 1), 'Unreleased', 0), DisplayOriginal, DisplayTextReformulation, DisplayAudioReformulation, IFNULL(ShowAllExpressions, 0), CourseID, replace(replace(replace(replace(TopicID, 986, 985), 979, 978), 973, 750), 985,984) from SmallTalkOld.Worksheets;

EXPRESSIONS ! LOSING ABOUT 2000 EXPRESSIONS WITH NULL FOR EXPRESSION FIELD?
insert ignore into ComSemApp_expression select ExpressionID, Expression, Pronunciation, ContextVocabulary, ReformulationText, IFNULL(ReformulationAudio, 0), WorksheetID, StudentID from SmallTalkOld.Expressions where Expression is not null AND studentid in (select id from ComSemApp_student);



ENROLLMENT
insert ignore into ComSemApp_course_students select EnrollmentID, CourseID, StudentID from SmallTalkOld.Enrollment;


insert ignore into ComSemApp_studentsubmission select ss.StudentSubmissionID, ss.Date, ss.Status, ss.WorksheetID, e.studentid from SmallTalkOld.Enrollment e, SmallTalkOld.StudentSubmissions ss where ss.enrollmentid = e.enrollmentid;

insert ignore into ComSemApp_studentattempt select StudentAttemptID, ReformulationText, IFNULL(ReformulationAudio, 0), Correct, ExpressionID, StudentSubmissionID from SmallTalkOld.StudentAttempts;
